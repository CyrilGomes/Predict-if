<!DOCTYPE html>
<html>
    <head>
        <title>Predicti'if Accueil</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="index.css">
        <!-- Librairie Javascript: jQuery (v3.4.1) -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body style="display: none;">

        <!-- HEADER -->
        <div class="header">
            <a href="index.html" class="logo">Predict'IF</a>
            <div class="header-right" id='headerContent'>
                <a href="#" id="boutonPopupConnexion1">Se connecter</a>
                <a href="#" id="boutonPopupInscription1">S'inscrire</a>
            </div>
        </div>

        <!-- Banner Image --> 
        <div class="banner-image">
            <div class="banner-text"> </div>
            <div class="banner-text">
                <h1><strong>Il est temps de regarder votre avenir droit dans les yeux.</strong></h1>
                <p>Explorez les tréfonds de votre esprit accompagné de médiums<br />professionnels certifiés</p>
                <p><strong>Un voyant à votre service, maintenant, par téléphone</strong></p>
                <br />
                <button id="boutonPopupConnexion2">Commencer l'aventure, faire appel</button>
            </div>
        </div>

        <!-- Popup de connexion -->
        <div id="overlayConnexion" class="popup">
            <div class="popupConnexion">
                <span id="fermerPopupConnexion" class="fermerPopup">&times;</span>
                <h1><span class="ligne">Se connecter</span></h1>
                <br/>
                <table>
                    <tr>
                        <td><strong>Adresse Mail :</strong></td>
                        <td><div><input type="text" id="champ-mail-connexion" /></div></td>
                    </tr>
                    <tr>
                        <td><strong>Mot de Passe :</strong></td>
                        <td><div><input type="password" id="champ-mdp-connexion" /></div></td>
                    </tr>
                    <tr>
                        <td colspan=2><div><button id="bouton-connexion">Connexion</button></div></td>
                    </tr>
                </table>
                <p><strong>Vous n'avez pas de compte? <a href="#" id="boutonPopupInscription2" class="hyperlien">Inscrivez-vous</a> en 2 clics</strong></p>
                <p id="messageErreurConnexion" class="texteErreur"></p>
            </div>
        </div>

        <!-- Popup d'inscription -->
        <div id="overlayInscription" class="popup">
            <div class="popupInscription">
                <span id="fermerPopupInscription" class="fermerPopup">&times;</span>
                <h1><span class="ligne">S'inscrire</span></h1>
                <br/>
                <div id="formulaireInscription">
                    <table>
                        <tr>
                            <td><strong>Nom :</strong> <input type="text" id="champ-nom-inscription" /></td>
                            <td><strong>Prénom :</strong> <input type="text" id="champ-prenom-inscription" /></td>
                        </tr>
                        <tr>
                            <td><strong>Date de Naissance :</strong> <input type="date" id="champ-date-naissance-inscription" /></td>
                            <td><strong>Code Postal :</strong> <input type="text" id="champ-code-postal-inscription" /></td>
                        </tr>
                        <tr>
                            <td><strong>Telephone :</strong> <input type="tel" id="champ-tel-inscription" /></td>
                            <td></td>
                        </tr>
                    </table>
                    <br />
                    <hr />
                    <table>
                        <tr>
                            <td><strong>Adresse Mail :</strong> <input type="text" id="champ-mail-inscription" /></td>
                            <td><strong>Mot de Passe :</strong> <input type="password" id="champ-mdp-inscription" /></td>
                        </tr>
                        <tr>
                            <td colspan=2><div><button id="bouton-inscription">Inscription</button></div></td>
                        </tr>
                    </table>
                    <p id="messageErreurInscription" class="texteErreur"></p>
                </div> 
                <div id="confirmationInscription" style="display: none;">
                    <hr /><br />
                    <p><strong>
                            Inscription réussie!
                            <br /><br />
                            Vous recevrez un mail de confirmation suite auquel vous pourrez vous <a href="#" id="boutonPopupConnexion3" class="hyperlien">Connecter</a>.
                        </strong></p>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function () {

                // REDIRIGER VERS UNE AUTRE PAGE SI CE N'EST PAS LE BON USER 
                // Appel AJAX
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        todo: 'obtenirTypeUtilisateurCourant'
                    },
                    dataType: 'json'
                })
                        .done(function (response) {
                            console.log('Response', response);
                            // Si l'utilisateur est déjà logué
                            if (response.utilisateur) {
                                // Changer les boutons du header et le lien du bouton
                                if (response.type == "employe") {
                                    $('#headerContent').html(
                                        "<a href='#'>Consultation en cours</a>" +
                                        "<a href='tableau-de-bord.html'>Tableau de Bord</a>" +
                                        "<a href='profil.html'>Profil</a>"
                                    );
                                    $('#boutonPopupConnexion2').click(function() { window.location.replace("tableau-de-bord.html")});
                                    
                                }
                                else {
                                    $('#headerContent').html(
                                        "<a href='demande-consultation.html'>Demander une Consultation</a>" +
                                        "<a href='#'>Historique</a>" +
                                        "<a href='profil.html'>Profil</a>"
                                    );
                                    $('#boutonPopupConnexion2').click(function() { window.location.replace("demande-consultation.html")});
                                }
                            }
                        })
                        .fail(function (error) {
                            console.log('Error', error);
                            alert("Erreur lors de l'appel AJAX");
                        })
                        .always(function () {
                            // Afficher la page 
                            $('body').css({"display": "block"});
                        });
                // SERVICE CONNEXION 
                $('#bouton-connexion').on('click', function () {

                    console.log("clic sur le bouton de connexion");
                    $('#bouton-connexion').html("Connexion...");
                    $('#messageErreurConnexion').html("");
                    // Récupération de la valeur des champs du formulaire
                    var champMail = $('#champ-mail-connexion').val();
                    var champMdp = $('#champ-mdp-connexion').val();
                    // Si les champs sont vides, arrêter
                    if (champMail == '' || champMdp == '') {
                        $('#messageErreurConnexion').html("Veuillez compléter tous les champs");
                        $('#bouton-connexion').html("Connexion");
                        return;
                    }

                    // Appel AJAX
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'connexion',
                            login: champMail,
                            password: champMdp
                        },
                        dataType: 'json'
                    })
                            .done(function (response) {
                                console.log('Response', response);
                                // Si la connexion a réussi (utilisateur retourné)...
                                if (response.utilisateur) {
                                    // S'il est de type client...
                                    if (response.type == "client") {
                                        // Rediriger vers la page Demande Consultation
                                        window.location.replace("demande-consultation.html");
                                    }
                                    // S'il est de type employé...
                                    else {
                                        // Rediriger vers la page Tableau de Bord
                                        window.location.replace("tableau-de-bord.html");
                                    }
                                }
                                // Sinon...
                                else {
                                    // Afficher un message d'erreur
                                    $('#messageErreurConnexion').html("Erreur de connexion. Veuillez réessayer");
                                }
                            })
                            .fail(function (error) {
                                console.log('Error', error);
                                alert("Erreur lors de l'appel AJAX");
                            })
                            .always(function () {
                                $('#bouton-connexion').html("Connexion");
                            });
                });
                // SERVICE INSCRIPTION 
                $('#bouton-inscription').on('click', function () {

                    console.log("clic sur le bouton de inscription");
                    $('#bouton-inscription').html("Inscription...");
                    $('#messageErreurInscription').html("");
                    // Récupération de la valeur des champs du formulaire
                    var champNom = $('#champ-nom-inscription').val();
                    var champPrenom = $('#champ-prenom-inscription').val();
                    var champDateNaissance = $('#champ-date-naissance-inscription').val();
                    var champCodePostal = $('#champ-code-postal-inscription').val();
                    var champTel = $('#champ-tel-inscription').val();
                    var champMail = $('#champ-mail-inscription').val();
                    var champMdp = $('#champ-mdp-inscription').val();
                    // Si les champs sont vides, arrêter
                    if (champNom == '' || champPrenom == '' || champDateNaissance == '' || champCodePostal == '' || champTel == '' || champMail == '' || champMdp == '') {
                        $('#messageErreurInscription').html("Veuillez compléter tous les champs");
                        $('#bouton-inscription').html("Inscription");
                        return;
                    }

                    // Appel AJAX
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'inscription',
                            nom: champNom,
                            prenom: champPrenom,
                            dateNaissance: champDateNaissance,
                            codePostal: champCodePostal,
                            tel: champTel,
                            email: champMail,
                            mdp: champMdp

                        },
                        dataType: 'json'
                    })
                            .done(function (response) {
                                console.log('Response', response);
                                // Si l'inscription a réussi (utilisateur retourné)...
                                if (response.utilisateur) {
                                    // Cacher le formulaire et afficher la confirmation d'inscription
                                    formulaireInscription.style.display = "none";
                                    confirmationInscription.style.display = "block";
                                }
                                // Sinon...
                                else {
                                    // Afficher un message d'erreur
                                    $('#messageErreurInscription').html("Erreur d'inscription. Veuillez réessayer");
                                }
                            })
                            .fail(function (error) {
                                console.log('Error', error);
                                alert("Erreur lors de l'appel AJAX");
                            })
                            .always(function () {
                                $('#bouton-inscription').html("Inscription");
                            });
                });
            });
            // POPUP DE CONNEXION 
            // Fonction d'ouverture du popup
            function showPopupConnexion() {
                // Désafficher popup inscription
                overlayInscription.style.display = "none";
                // Afficher
                overlayConnexion.style.display = "block";
                // Reset les éléments
                $('#messageErreurConnexion').html("");
                $('#bouton-connexion').html("Connexion");
                $('#champ-mail-connexion').val('');
                $('#champ-mdp-connexion').val('');
            }
            // Fonction de fermeture
            function hidePopupConnexion() {
                overlayConnexion.style.display = "none";
            }
            // Attribuer les fonctions 
            $('#boutonPopupConnexion1').click(showPopupConnexion);
            $('#boutonPopupConnexion2').click(showPopupConnexion);
            $('#boutonPopupConnexion3').click(showPopupConnexion);
            $('#fermerPopupConnexion').click(hidePopupConnexion);
            // POPUP D'INSCRIPTION
            // Fonction d'ouverture du popup
            function showPopupInscription() {
                // Reset les divs 
                formulaireInscription.style.display = "block";
                confirmationInscription.style.display = "none";
                // Désafficher popup connexion
                overlayConnexion.style.display = "none";
                // Afficher
                overlayInscription.style.display = "block";
                // Reset les éléments
                $('#messageErreurInscription').html("");
                $('#bouton-inscription').html("Inscription");
                $('#champ-nom-inscription').val('');
                $('#champ-prenom-inscription').val('');
                $('#champ-date-naissance-inscription').val('');
                $('#champ-mail-inscription').val('');
                $('#champ-code-postal-inscription').val('');
                $('#champ-tel-inscription').val('');
                $('#champ-mail-inscription').val('');
                $('#champ-mdp-inscription').val('');
            }
            // Fonction de fermeture
            function hidePopupInscription() {
                overlayInscription.style.display = "none";
            }
            // Attribuer les fonctions 
            $('#boutonPopupInscription1').click(showPopupInscription);
            $('#boutonPopupInscription2').click(showPopupInscription);
            $('#fermerPopupInscription').click(hidePopupInscription);
            // FERMETURE AUTOMATIQUE DES POPUPS
            window.onclick = function (event) {
                if (event.target === overlayConnexion) {
                    hidePopupConnexion();
                }
                if (event.target === overlayInscription) {
                    hidePopupInscription();
                }
            };
        </script>

    </body>
</html>
