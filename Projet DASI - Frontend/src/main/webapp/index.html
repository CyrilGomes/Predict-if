<!DOCTYPE html>
<html>
    <head>
        <title>Predicti'if Accueil</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="main.css">
        <!-- Librairie Javascript: jQuery (v3.4.1) -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body>

        <!-- HEADER -->
        <div class="header">
            <a href="index.html" class="logo">Predict'IF</a>
            <div class="header-right">
                <a href="#" id="boutonPopupConnexion1">Se connecter</a>
                <a href="#" id="boutonPopupInscription1">S'inscrire</a>
            </div>
        </div>

        <!-- Banner Image --> 
        <div class="banner-image">
            <div class="banner-text"> </div>
            <div class="banner-text">
                <h1><strong>Il est temps de regarder votre avenir droit dans les yeux.</strong></h1>
                <p>Explorez les tréfonds de votre esprit accompagné de médiums professionnels certifiés</p>
                <p><strong>Un voyant à votre service, maintenant, par téléphone</strong></p>
                <br />
                <button id="boutonPopupConnexion2">Commencer l'aventure, faire appel</button>
            </div>
        </div>

        <!-- Popup de connexion -->
        <div id="overlayConnexion" class="popup">
            <div class="popupConnexion">
                <span id="fermerPopupConnexion" class="fermerPopup">&times;</span>
                <h1><span class="ligne">Se connecter</span></h1>
                <br/>
                <table>
                    <tr>
                        <td><strong>Adresse Mail :</strong></td>
                        <td><div><input type="text" id="champ-mail-connexion" /></div></td>
                    </tr>
                    <tr>
                        <td><strong>Mot de Passe :</strong></td>
                        <td><div><input type="password" id="champ-mdp-connexion" /></div></td>
                    </tr>
                    <tr>
                        <td colspan=2><div><button id="bouton-connexion">Connexion</button></div></td>
                    </tr>
                </table>
                <p><strong>Vous n'avez pas de compte? <a href="#" id="boutonPopupInscription2" class="hyperlien">Inscrivez-vous</a> en 2 clics</strong></p>
                <p id="messageErreurConnexion" class="texteErreur"></p>
            </div>
        </div>

        <!-- Popup d'inscription -->
        <div id="overlayInscription" class="popup">
            <div class="popupInscription">
                <span id="fermerPopupInscription" class="fermerPopup">&times;</span>
                <h1><span class="ligne">S'inscrire</span></h1>
                <br/>
                <table>
                    <tr>
                        <td><strong>Nom :</strong> <div><input type="text" id="champ-nom-inscription" /></div></td>
                        <td><strong>Prénom :</strong> <div><input type="text" id="champ-prenom-inscription" /></div></td>
                    </tr>
                    <tr>
                        <td><strong>Date de Naissance :</strong> <div><input type="date" id="champ-date-naissance-inscription" /></div></td>
                        <td><strong>Code Postal :</strong> <div><input type="text" id="champ-code-postal-inscription" /></div></td>
                    </tr>
                    <tr>
                        <td><strong>Telephone :</strong> <div><input type="tel" id="champ-tel-inscription" /></div></td>
                        <td></td>
                    </tr>
                </table>
                <br />
                <hr />
                <table>
                    <tr>
                        <td><strong>Adresse Mail :</strong> <div><input type="text" id="champ-mail-inscription" /></div></td>
                        <td><strong>Mot de Passe :</strong> <div><input type="password" id="champ-mdp-inscription" /></div></td>
                    </tr>
                    <tr>
                        <td colspan=2><div><button id="bouton-inscription">Inscription</button></div></td>
                    </tr>
                </table>
                <p id="messageSuccesInscription"></p>
                <p id="messageErreurInscription" class="texteErreur"></p>
            </div>
        </div>

        <script>
            $(document).ready(function () {

                /* SERVICE CONNEXION */
                $('#bouton-connexion').on('click', function () {

                    console.log("clic sur le bouton de connexion");
                    $('#bouton-connexion').html("Connexion...");

                    // Récupération de la valeur des champs du formulaire
                    var champMail = $('#champ-mail-connexion').val();
                    var champMdp = $('#champ-mdp-connexion').val();

                    // Appel AJAX
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'connexion',
                            login: champMail,
                            password: champMdp
                        },
                        dataType: 'json'
                    })
                            .done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                                console.log('Response', response);
                                if (response.connexion) {
                                    // TODO: rediriger vers la page Demande Consultation
                                } else {
                                    $('#messageErreurConnexion').html("Erreur de connexion. Veuillez réessayer");
                                    $('#bouton-connexion').html("Connexion");
                                }
                            })
                            .fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                                console.log('Error', error);
                                alert("Erreur lors de l'appel AJAX");
                            })
                            .always(function () { // Fonction toujours appelée
                            });
                });

                /* SERVICE INSCRIPTION */
                $('#bouton-inscription').on('click', function () {

                    console.log("clic sur le bouton de inscription");
                    $('#bouton-inscription').html("Inscription...");

                    // Récupération de la valeur des champs du formulaire
                    var champNom = $('#champ-nom-inscription').val();
                    var champPrenom = $('#champ-prenom-inscription').val();
                    var champDateNaissance = $('#champ-date-naissance-inscription').val();
                    var champCodePostal = $('#champ-code-postal-inscription').val();
                    var champTel = $('#champ-tel-inscription').val();
                    var champMail = $('#champ-mail-inscription').val();
                    var champMdp = $('#champ-mdp-inscription').val();

                    // Appel AJAX
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'inscription',
                            nom: champNom,
                            prenom: champPrenom,
                            dateNaissance: champDateNaissance,
                            codePostal: champCodePostal,
                            tel: champTel,
                            email: champMail,
                            mdp: champMdp

                        },
                        dataType: 'json'
                    })
                            .done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                                console.log('Response', response);
                                if (response.inscription) {
                                    var str = "<strong>Inscription réussie!</strong><br />Vous recevrez un mail de confirmation suite auquel vous pourrez vous Connecter.<br/><br/>(je n'arrive pas encore à remplaçer tout le div par ce texte du coup je l'ai simplement append, ça me rend fou)";
                                    $('#messageSuccesInscription').html(str);
                                    $('#bouton-inscription').html("Inscription");
                                } else {
                                    $('#messageErreurInscription').html("Erreur d'inscription. Veuillez réessayer");
                                    $('#bouton-inscription').html("Inscription");
                                }
                            })
                            .fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                                console.log('Error', error); 
                                alert("Erreur lors de l'appel AJAX");
                            })
                            .always(function () { // Fonction toujours appelée

                            });
                });

            });
            
            /* POPUP DE CONNEXION */
            // Fonction d'ouverture du popup
            function showPopupConnexion() {
                // Afficher
                overlayConnexion.style.display = "block";
                // Reset les éléments
                $('#messageErreurConnexion').html("");
                $('#bouton-connexion').html("Connexion");
                $('#champ-mail-connexion').val('');
                $('#champ-mdp-connexion').val('');
            }
            // Fonction de fermeture
            function hidePopupConnexion() {
                overlayConnexion.style.display = "none";
            }
            // Attribuer les fonctions 
            $('#boutonPopupConnexion1').click(showPopupConnexion);
            $('#boutonPopupConnexion2').click(showPopupConnexion);
            $('#fermerPopupConnexion').click(hidePopupConnexion);
            
            /* POPUP D'INSCRIPTION*/
            // Fonction d'ouverture du popup
            function showPopupInscription() {
                // Désafficher popup connexion
                overlayConnexion.style.display = "none";
                // Afficher
                overlayInscription.style.display = "block";
                // Reset les éléments
                $('#messageErreurInscription').html("");
                $('#bouton-inscription').html("Inscription");
                $('#champ-nom-inscription').val('');
                $('#champ-prenom-inscription').val('');
                $('#champ-date-naissance-inscription').val('');
                $('#champ-mail-inscription').val('');
                $('#champ-code-postal-inscription').val('');
                $('#champ-tel-inscription').val('');
                $('#champ-mail-inscription').val('');
                $('#champ-mdp-inscription').val('');
            }
            // Fonction de fermeture
            function hidePopupInscription() {
                overlayInscription.style.display = "none";
            }
             // Attribuer les fonctions 
            $('#boutonPopupInscription1').click(showPopupInscription);
            $('#boutonPopupInscription2').click(showPopupInscription);
            $('#fermerPopupInscription').click(hidePopupInscription);
            
            /* FERMETURE AUTOMATIQUE DES POPUPS*/
            window.onclick = function (event) {
                if (event.target === overlayConnexion) {
                    hidePopupConnexion();
                }
                if (event.target === overlayInscription) {
                    hidePopupInscription();
                }
            };
        </script>

    </body>
</html>
